<html>

<head>
    <title>SecureShare</title>
    <link rel="stylesheet" href="/assets/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>

<body>
    <!-- delete file modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="deleteModalLabel">Action needed</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="deleteForm" class="row g-3" action="/api/files" method="get">
                        <div class="col-auto">
                          <button type="submit" class="btn btn-primary mb-3" onclick="deleteFile(event)">DELETE</button>
                        </div>
                      </form>
                </div>
            </div>
        </div>
    </div>

    <!-- share file modal -->
    <div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="shareModalLabel">Action needed</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                            <form id="shareForm" class="row g-3" action="/api/files" method="get">
                                <div class="col-auto">
                                  <label for="username" class="visually-hidden">username</label>
                                  <input type="text" name="username" class="form-control" placeholder="username">
                                </div>
                                <div class="col-auto">
                                  <label for="expiry" class="visually-hidden">expiry</label>
                                  <input type="number" name="expiry" class="form-control" placeholder="expiry (in minutes)">
                                </div>
                                <div class="col-auto">
                                  <button type="submit" class="btn btn-primary mb-3">Share</button>
                                </div>
                              </form>
                </div>
            </div>
        </div>
    </div>

    <div class="header">
        <img id="logo" src="/assets/logo.png" width="200px" alt="">
        <br>
        <a href="/api/auth/signout">
            <button type="button" class="btn btn-primary">
                Sign out
              </button>
        </a>
    
        <a href="/api/user/messages">
              <button type="button" class="btn btn-primary position-relative">
                Notifications
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                    <%=messages.length%>
                  <span class="visually-hidden">unread messages</span>
                </span>
              </button>
        </a>
        <p>User id: <%= userId %>
        </p>
    </div>

    <table class="table">
        <thead>
            <tr>
                <th scope="col">Filename</th>
                <th scope="col">Size</th>
                <th scope="col">Download</th>
                <th scope="col">Delete</th>
                <th scope="col">share</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="4">
                    Upload new files
                </td>
            </tr>
            <% files?.forEach(file=> { %>
                <tr>
                    <td>
                        <%= file.fileName %>
                    </td>
                    <td>
                        <%= file.size %>
                    </td>
                    <td><a class="button-links download" href="<%= file.fileUrl %>" target="_blank"><img
                                src="/assets/download.png" alt="download"></a></td>

                    <td><input type="button" data-bs-toggle="modal" data-bs-target="#deleteModal"
                        class="btn btn-primary" data-shareurl="/api/files/<%= file._id %>" value="delete" onclick=changeDeleteUrl(event)></td>

                    <td><input type="button" data-bs-toggle="modal" data-bs-target="#shareModal" class="btn btn-primary"
                            data-shareurl="/api/files/<%= file._id %>" onclick=changeShareUrl(event) value="share"></td>
                </tr>
                <% }) %>
        </tbody>
    </table>

    <form id="folderForm" action="/api/files" enctype="multipart/form-data" method="post">
        <div class="container-drop">
            <h1>
                upload file here
            </h1>
            <div>
                <input class="form-control form-control-lg" name="file" id="formFileLg" type="file" required>
                <input type="submit" class="submit-button btn btn-primary" value="upload">
            </div>
        </div>
    </form>

</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script src="/script.js"></script>

</html>

<!-- 
https://new-bucket-file-to-access.s3.us-east-1.amazonaws.com/
65c855f47ed15d6049dd6dcd/Assignment04_Instructions.docx?
X-Amz-Algorithm=AWS4-HMAC-SHA256&
X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&
X-Amz-Credential=AKIAZASA6KURLYUTYN6J%2F20240214%2Fus-east-1%2Fs3%2Faws4_request&
X-Amz-Date=20240214T202800Z&
X-Amz-Expires=60&
X-Amz-Signature=32932f398653909421eccca1382f84966dc38955e92d93c953fc972f340b7b50&
X-Amz-SignedHeaders=host&x-id=GetObject 

https://new-bucket-file-to-access.s3.us-east-1.amazonaws.com/
65c855f47ed15d6049dd6dcd/cloud.svg?
X-Amz-Algorithm=AWS4-HMAC-SHA256&
X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&
X-Amz-Credential=AKIAZASA6KURLYUTYN6J%2F20240214%2Fus-east-1%2Fs3%2Faws4_request&
X-Amz-Date=20240214T204708Z&
X-Amz-Expires=120&
X-Amz-Signature=dc46eb3a872760d2840cb962e11b87427c2e1bd9563ab74dcdf5cc9933ea44dd&
X-Amz-SignedHeaders=host&
x-id=GetObject
-->

